// SkillXIntell Database Schema
// Holistic Academic and Professional Skill Intelligence System

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================
// USER MANAGEMENT
// ============================================

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  name          String
  passwordHash  String?
  role          String   @default("STUDENT") // Enum Role
  avatar        String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  profile        Profile?
  skills         Skill[]
  projects       Project[]
  certifications Certification[]
  learningPaths  LearningPath[]
  analytics      SkillAnalytics[]

  @@index([email])
  @@index([role])
}

// ============================================
// PROFILE
// ============================================

model Profile {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  bio             String?
  phone           String?
  location        String?
  linkedIn        String?
  github          String?
  portfolio       String?
  dateOfBirth     DateTime?

  // Education history (JSON array)
  education       String? // Json stored as string

  // Work experience (JSON array)
  experience      String? // Json stored as string

  // Interests and goals
  interests       String? // String[] stored as JSON string "[]"
  targetSectors   String? // Sector[] stored as JSON string "[]"
  careerGoals     String?

  // Preferences
  preferredLearningStyle String?
  availableHoursPerWeek  Int?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
}

// ============================================
// SKILLS
// ============================================

model Skill {
  id                String        @id @default(uuid())
  userId            String
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  name              String
  category          String        // Enum SkillCategory
  sector            String        // Enum Sector
  proficiencyLevel  Int           // 1-5 scale

  // Verification
  verified          Boolean       @default(false)
  verificationSource String?

  // Metadata
  tags              String?       // String[] stored as JSON string "[]"
  description       String?
  yearsOfExperience Float?
  lastUsed          DateTime?

  // Endorsements
  endorsements      Int           @default(0)

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([userId, sector])
  @@index([sector, category])
  @@index([name])
}

// ============================================
// PROJECTS
// ============================================

model Project {
  id              String          @id @default(uuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  title           String
  description     String
  sector          String          // Enum Sector
  category        String          // Enum ProjectCategory

  // Skills and technologies
  skillsUsed      String?         // String[] stored as JSON string "[]"
  technologies    String?         // String[] stored as JSON string "[]"

  // Outcomes and impact
  outcomes        String
  impact          String?
  metrics         String?         // Json stored as string

  // Timeline
  startDate       DateTime
  endDate         DateTime?
  status          String          @default("IN_PROGRESS") // Enum ProjectStatus

  // Collaboration
  teamSize        Int?
  role            String?

  // Attachments and links
  attachments     String?         // Json stored as string
  repositoryUrl   String?
  liveUrl         String?

  // Visibility
  isPublic        Boolean         @default(true)

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([userId, sector])
  @@index([sector, status])
}

// ============================================
// CERTIFICATIONS
// ============================================

model Certification {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  name            String
  issuingOrg      String
  sector          String   // Enum Sector

  credentialId    String?
  credentialUrl   String?

  issueDate       DateTime
  expiryDate      DateTime?
  neverExpires    Boolean  @default(false)

  // Related skills
  skills          String?  // String[] stored as JSON string "[]"

  // Verification
  verified        Boolean  @default(false)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId, sector])
  @@index([sector])
}

// ============================================
// LEARNING PATHS
// ============================================

model LearningPath {
  id              String     @id @default(uuid())
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  title           String
  description     String
  sector          String     // Enum Sector
  targetRole      String

  // Progress tracking
  currentStep     Int        @default(0)
  totalSteps      Int
  progress        Float      @default(0)

  // Learning steps (JSON array)
  steps           String     // Json stored as string

  // AI-generated recommendations
  recommendations String?    // Json stored as string

  // Timeline
  estimatedDuration Int?
  startDate       DateTime?
  targetEndDate   DateTime?

  status          String     @default("ACTIVE") // Enum PathStatus

  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@index([userId, sector])
  @@index([status])
}

// ============================================
// ANALYTICS
// ============================================

model SkillAnalytics {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  sector          String   // Enum Sector

  // Overall scores (0-100)
  overallScore    Float    @default(0)
  careerReadiness Float    @default(0)
  industryAlignment Float  @default(0)

  // Skill gaps and strengths (JSON)
  skillGaps       String   // Json stored as string
  strengths       String   // Json stored as string

  // Recommendations (JSON)
  recommendations String   // Json stored as string

  // Career insights
  suggestedRoles  String?  // String[] stored as JSON string "[]"
  marketDemand    String?  // Json stored as string

  // Calculation metadata
  calculatedAt    DateTime @default(now())
  dataPoints      Int      @default(0)

  @@index([userId, sector])
  @@index([calculatedAt])
}
